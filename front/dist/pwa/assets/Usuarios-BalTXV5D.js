import{_ as P,c as n,o as i,w as a,a as s,a0 as A,d as f,W as c,Z as g,f as u,a7 as h,h as D,Q as V,e as b,b as p,t as q,a1 as _,a2 as E}from"./index-BauECx7o.js";import{d as G,e as N,Q as v,a as m,c as C}from"./format-g9Qr7zkK.js";import{Q as I,C as w}from"./ClosePopup-D8gtAGJo.js";import{Q as z,a as y,b as S}from"./QTable-BirSJN0S.js";import{Q as B}from"./QImg-BL2LOL9x.js";import{Q as x}from"./QSpace-r0MaWTcZ.js";import{Q as U}from"./QForm-DVH7vej5.js";import{Q as F}from"./QPage-BXv6I5md.js";import"./moment-C5S46NFB.js";import"./selection-R2GtEYNB.js";import"./use-fullscreen-CjAxtF11.js";const T={name:"UsuariosPage",data(){return{users:[],user:{},userDialog:!1,loading:!1,actionUser:"",gestiones:[],filter:"",roles:["Administrador","Enfermera"],columns:[{name:"actions",label:"Acciones",align:"center"},{name:"name",label:"Nombre",align:"left",field:"name"},{name:"username",label:"Usuario",align:"left",field:"username"},{name:"avatar",label:"Avatar",align:"left",field:r=>r.avatar},{name:"role",label:"Rol",align:"left",field:"role"},{name:"docente",label:"Docente",align:"left",field:r=>r.docente?.nombre}],permissions:[],dialogPermisos:!1,cambioAvatarDialogo:!1,docentes:[]}},async mounted(){this.usersGet()},methods:{onFileChange(r){const e=r.target.files[0],d=new FormData;d.append("avatar",e),this.loading=!0,this.$axios.post(this.user.id+"/avatar",d,{headers:{"Content-Type":"multipart/form-data"}}).then(k=>{this.cambioAvatarDialogo=!1,this.$alert.success("Avatar actualizado"),this.usersGet()}).catch(k=>{this.$alert.error(k.response.data.message)}).finally(()=>{this.loading=!1})},cambiarAvatar(r){this.cambioAvatarDialogo=!0,this.user={...r}},userNew(){this.user={name:"",email:"",password:"",area_id:1,username:"",cargo:"",role:"Enfermera"},this.actionUser="Nuevo",this.userDialog=!0},usersGet(){this.loading=!0,this.users=[],this.$axios.get("users").then(r=>{this.users=r.data}).catch(r=>{this.$alert.error(r.response.data.message)}).finally(()=>{this.loading=!1})},gestionGet(){this.loading=!0,this.$axios.get("gestiones").then(r=>{this.gestiones=r.data,this.loading=!1}).catch(r=>{this.$alert.error(r.response.data.message),this.loading=!1})},userPost(){this.loading=!0,this.$axios.post("users",this.user).then(r=>{this.userDialog=!1,this.$alert.success("User creado"),this.usersGet()}).catch(r=>{this.$alert.error(r.response.data.message)}).finally(()=>{this.loading=!1})},userPut(){this.loading=!0,this.$axios.put("users/"+this.user.id,this.user).then(r=>{this.usersGet(),this.userDialog=!1,this.$alert.success("User actualizado")}).catch(r=>{this.$alert.error(r.response.data.message)}).finally(()=>{this.loading=!1})},permisosShow(r){this.dialogPermisos=!0,this.user={...r},this.permissions.forEach(e=>{e.checked=r.userPermisos.some(d=>d.permisoId===e.id)})},userEditPassword(r){this.user={...r},this.$alert.dialogPrompt("Nueva contraseña","Ingrese la nueva contraseña","password").onOk(e=>{this.$axios.put("updatePassword/"+r.id,{newPassword:e}).then(d=>{this.usersGet(),this.$alert.success("Contraseña actualizada de "+r.username)}).catch(d=>{this.$alert.error(d.response.data.message)})})},userEdit(r){this.user={...r},this.actionUser="Editar",this.userDialog=!0},userDelete(r){this.$alert.dialog("¿Desea eliminar el user?").onOk(()=>{this.loading=!0,this.$axios.delete("users/"+r).then(e=>{this.usersGet(),this.$alert.success("User eliminado")}).catch(e=>{this.$alert.error(e.response.data.message)}).finally(()=>{this.loading=!1})})}}},O={class:"text-right"},L={style:{position:"relative",top:"0",left:"0"}},R=["src"],W={class:"text-right"};function Z(r,e,d,k,t,o){return i(),n(F,{class:"q-pa-md"},{default:a(()=>[s(z,{rows:t.users,columns:t.columns,dense:"","wrap-cells":"",flat:"",bordered:"","rows-per-page-options":[0],title:"Usuarios",filter:t.filter},{"top-right":a(()=>[s(u,{color:"positive",label:"Nuevo",onClick:o.userNew,"no-caps":"",icon:"add_circle_outline",loading:t.loading,class:"q-mr-sm"},null,8,["onClick","loading"]),s(u,{color:"primary",label:"Actualizar",onClick:o.usersGet,"no-caps":"",icon:"refresh",loading:t.loading},null,8,["onClick","loading"]),s(h,{modelValue:t.filter,"onUpdate:modelValue":e[0]||(e[0]=l=>t.filter=l),label:"Buscar",dense:"",outlined:""},{append:a(()=>[s(f,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-actions":a(l=>[s(y,{props:l},{default:a(()=>[s(I,{label:"Opciones","no-caps":"",size:"10px",dense:"",color:"primary"},{default:a(()=>[s(N,null,{default:a(()=>[c((i(),n(v,{clickable:"",onClick:Q=>o.userEdit(l.row)},{default:a(()=>[s(m,{avatar:""},{default:a(()=>[s(f,{name:"edit"})]),_:1}),s(m,null,{default:a(()=>[s(C,null,{default:a(()=>e[15]||(e[15]=[g("Editar")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[w]]),c((i(),n(v,{clickable:"",onClick:Q=>o.userDelete(l.row.id)},{default:a(()=>[s(m,{avatar:""},{default:a(()=>[s(f,{name:"delete"})]),_:1}),s(m,null,{default:a(()=>[s(C,null,{default:a(()=>e[16]||(e[16]=[g("Eliminar")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[w]]),c((i(),n(v,{clickable:"",onClick:Q=>o.userEditPassword(l.row)},{default:a(()=>[s(m,{avatar:""},{default:a(()=>[s(f,{name:"lock_reset"})]),_:1}),s(m,null,{default:a(()=>[s(C,null,{default:a(()=>e[17]||(e[17]=[g("Cambiar contraseña")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[w]]),c((i(),n(v,{clickable:"",onClick:Q=>o.cambiarAvatar(l.row)},{default:a(()=>[s(m,{avatar:""},{default:a(()=>[s(f,{name:"image"})]),_:1}),s(m,null,{default:a(()=>[s(C,null,{default:a(()=>e[18]||(e[18]=[g("Cambiar avatar")])),_:1})]),_:1})]),_:2},1032,["onClick"])),[[w]])]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-role":a(l=>[s(y,{props:l},{default:a(()=>[s(G,{label:l.row.role,color:r.$filters.color(l.row.role),"text-color":"white",dense:"",size:"14px"},null,8,["label","color"])]),_:2},1032,["props"])]),"body-cell-avatar":a(l=>[s(y,{props:l},{default:a(()=>[s(A,{rounded:""},{default:a(()=>[l.row.avatar?(i(),n(B,{key:0,src:`${r.$url}/../images/${l.row.avatar}`,width:"40px",height:"40px"},null,8,["src"])):(i(),n(f,{key:1,name:"person",size:"40px"}))]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter"]),s(D,{modelValue:t.userDialog,"onUpdate:modelValue":e[8]||(e[8]=l=>t.userDialog=l),persistent:""},{default:a(()=>[s(V,{style:{width:"400px"}},{default:a(()=>[s(b,{class:"q-pb-none row items-center"},{default:a(()=>[p("div",null,q(t.actionUser)+" user ",1),s(x),s(u,{icon:"close",flat:"",round:"",dense:"",onClick:e[1]||(e[1]=l=>t.userDialog=!1)})]),_:1}),s(b,{class:"q-pt-none"},{default:a(()=>[s(U,{onSubmit:e[7]||(e[7]=l=>t.user.id?o.userPut():o.userPost())},{default:a(()=>[s(h,{modelValue:t.user.name,"onUpdate:modelValue":e[2]||(e[2]=l=>t.user.name=l),label:"Nombre",dense:"",outlined:"",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"]),s(h,{modelValue:t.user.username,"onUpdate:modelValue":e[3]||(e[3]=l=>t.user.username=l),label:"Usuario",dense:"",outlined:"",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"]),t.user.id?_("",!0):(i(),n(h,{key:0,modelValue:t.user.password,"onUpdate:modelValue":e[4]||(e[4]=l=>t.user.password=l),label:"Contraseña",dense:"",outlined:"",rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","rules"])),s(S,{modelValue:t.user.role,"onUpdate:modelValue":e[5]||(e[5]=l=>t.user.role=l),label:"Rol",dense:"",outlined:"",options:t.roles,rules:[l=>!!l||"Campo requerido"]},null,8,["modelValue","options","rules"]),p("div",O,[s(u,{color:"negative",label:"Cancelar",onClick:e[6]||(e[6]=l=>t.userDialog=!1),"no-caps":"",loading:t.loading},null,8,["loading"]),s(u,{color:"primary",label:"Guardar",type:"submit","no-caps":"",loading:t.loading,class:"q-ml-sm"},null,8,["loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(D,{modelValue:t.cambioAvatarDialogo,"onUpdate:modelValue":e[14]||(e[14]=l=>t.cambioAvatarDialogo=l),persistent:""},{default:a(()=>[s(V,null,{default:a(()=>[s(b,{class:"q-pb-none row items-center text-bold"},{default:a(()=>[e[19]||(e[19]=g(" Cambiar avatar ")),s(x),s(u,{icon:"close",flat:"",round:"",dense:"",onClick:e[9]||(e[9]=l=>t.cambioAvatarDialogo=!1)})]),_:1}),s(b,{class:"q-pt-none"},{default:a(()=>[s(U,{onSubmit:e[13]||(e[13]=l=>o.userPut())},{default:a(()=>[p("div",null,[p("div",L,[s(u,{icon:"edit",size:"10px",class:"absolute q-mt-sm q-ml-sm",onClick:e[10]||(e[10]=l=>r.$refs.fileInput.click()),dense:"",outline:"",label:"Cambiar foto","no-caps":""})]),t.user.avatar?(i(),E("img",{key:0,src:`${r.$url}/../images/${t.user.avatar}`,width:"300px",height:"300px"},null,8,R)):(i(),n(f,{key:1,name:"person",size:"100px"})),p("input",{ref:"fileInput",type:"file",style:{display:"none"},onChange:e[11]||(e[11]=(...l)=>o.onFileChange&&o.onFileChange(...l)),accept:"image/*"},null,544)]),p("div",W,[s(u,{color:"negative",label:"Cancelar",onClick:e[12]||(e[12]=l=>t.cambioAvatarDialogo=!1),"no-caps":"",loading:t.loading},null,8,["loading"]),s(u,{color:"primary",label:"Guardar",type:"submit","no-caps":"",loading:t.loading,class:"q-ml-sm"},null,8,["loading"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const ae=P(T,[["render",Z]]);export{ae as default};
